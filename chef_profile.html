<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Foodie</title>

    <!-- Sets initial viewport load and disables zooming  -->
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />

    <!-- Makes your prototype chrome-less once bookmarked to your phone's home screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
  
    <link href="css/styles.css" rel="stylesheet">

  </head>
  <body>

    <nav class="navbar navbar-default" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>    
      </div>
      <a class="navbar-brand" href="#"></a>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-left">
            <li><a href="reservations.html">Food Listing</a></li>
            <li><a href="chef-listing.html">Chef Listing</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="chef.html">Chef</a></li>
          <li><a href="user-profile.html">User Profile</a></li>
        </ul>
      </div>
    </nav>


    <!-- Wrap all non-bar HTML in the .content div (this is actually what scrolls) -->
    <div id="chef-page" class="content">
      <div id="chef-banner">
        <div class="container">
          <div class="row">
              <div class="chef-profile-info">
                <h3 id="p_company">Brook Alex</h3>
                 <img src="images/0.gif" id="p_rating" > <span id="rating_text"></span>
              </div>
              <div class="chef-banner-image">
                <img id="p_image1" class="img-responsive banner-img img-rounded" src="data:image/gif;base64,R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="chef">
              </div>            
              
          </div>
        </div>
      </div>
		
		<div id="chef-info-cont">
        <div class="container">
          <div class="row">
            <div class="col-xs-4 chef-info">
              <div class="chef-info-box">
                <h3 id="p_people_served">0</h3>
                <p>People Served</p>
              </div>
            </div>
				<div class="col-xs-4 chef-info">
              <div class="chef-info-box">
                <h3 id="p_food_cost">0</h3>
                <p>Food Cost</p>
              </div>
            </div>
            <div class="col-xs-4 chef-info">
              <div class="chef-info-box last-info-box">
                <h3 id="p_rating_count">0</h3>
                <p>Reviews</p>
              </div>
            </div>            
          </div>
        </div>
      </div>
		
		
		
		<h2 class="text-center">Available Dishes</h2>
		
		
		
		
      <div id="chef-foods">
        
		  <div class="food-listing hidden">
          <div class="food-image-cont">
            <img class="img-responsive img-circle media-object pull-left" src="images/food-1.png" align="food img">
          </div>
          <div class="food-info-cont">
            <div class="food-info-body">
              <a class="dishTitle" href="#">Strawbery muffin</a><br />
                  <p class="dishInfo"></p>
						<img src="images/0.gif" alt="" class="rating" />
						<span class="rating_info"></span>
						<button data-dish="0" class="btn btn-xs btn-primary pull-right btnReserve">Reserve Now</button>  
	         </div>
          </div>
        </div>
        
		  <div class="aLoading text-center" style="display:none"><img src="images/loading.gif" sytle=" margin: 0 auto;" /></div>
        

        
      </div>
    </div>
	 
	
<br /><br /><br /><br /><br /><br />
	
<div class="modal fade" id="popReserve" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="popReserve">Add Reservation</h4>
      </div>
      <div class="modal-body">
 
 		<h4 id="modHeading" class="text-center">Ckicken Egg Fried Rice</h4>
		<p><img id="modImg" class="img-responsive text-center" src="http://mobileapi.foodiesys.com/foodie-mssql/pics/biryani.jpg"  /></p>
		
		<p id="modPrice" class="dishInfo">Price : $10.00 &nbsp; Serving : 2</p>
		<img id="modRatingImg" src="images/4.5.gif" alt="" class="rating"> &nbsp; <span id="modRatingInfo" class="rating_info">(4.5/5) &nbsp; 4 Reviews</span>
		
		<form method="post" id="frmReserve">
		<br />
		<div class="form-group">
			<label  class="">Quantity to Order</label>
			<div class=""><input type="number" name="quantity" class="form-control required" value="1" placeholder="Quantity to Order"></div>
		</div>
		
		
		
		<div class="form-group">
			<label  class="">Pickup Date</label>
			<div class=""><input type="date" name="d_date" class="form-control required" value="" placeholder="Pickup Date"></div>
		</div>
		
		<div class="form-group">
			<label  class="">Pickup Time</label>
			<div class=""><input type="time" name="d_time" class="form-control required" value="" placeholder="Pickup Time"></div>
		</div>
		<input type="hidden" id="dish_id" name="dish_id">
		<input type="hidden" id="chef_id" name="chef_id">
		<input type="hidden" id="user_id" name="user_id">
		<input type="hidden" id="unit_price" name="unit_price">
		</form>
	      
			
			
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button id="btnOrder" type="button" class="btn btn-primary">Order Now</button>
      </div>
    </div>
  </div>
</div>	
	
	 
	 <div id="bottom-bar">
      <div class="container">
        <div class="row">
          
            <div class="col-xs-4 no-padding">
            <a class="tab-item" href="#">
              <img class="tab-icon active" src="images/map-icon.png" alt="map-icon">          
              <!-- <i class="fa fa-map-o tab"></i> -->
              <img class="border-image" src="images/border-image.png" alt="border-image">
            </a>
            </div>
            <div class="col-xs-4 no-padding">
            <a class="tab-item " href="reservations.html">
              <img class="tab-icon" src="images/food-icon.png" alt="food-icon">                    
              <img class="border-image" src="images/border-image.png" alt="border-image">
            </a>
            </div>
            <div class="col-xs-4 no-padding">
            <a class="tab-item" href="user-profile.html">
              <img class="tab-icon" src="images/profile-icon.png" alt="map-icon">                    
            </a>        
            </div>
          
        </div>
      </div>
    </div>
    


    <!-- Script -->
    <script src="js/jquery-1.11.3.min.js"></script> 
    <script src="js/bootstrap.min.js"></script>
	 <script src="js/jquery.validate.min.js"></script> 
    <script src="js/common.js"></script>
<script>

var dishData;

$(document).ready(function(e) {
	var chef_id = getUrlParameter('id');
	
	
	var chef_data;
	if( chef_id > 0 ){
		
		
		
		var jsonData = JSON.parse(localStorage.getItem('chefsData'));
		for (var i = 0; i < jsonData.length; i++) {
			if( jsonData[i].id == chef_id ){
				chef_data = jsonData[i];
				break;
			}
		}
		$('#p_image1').prop('src', 'http://mobileapi.foodiesys.com/foodie-mssql/pics/'+chef_data.image2);
		$('#p_company').html(chef_data.company);
		$('#p_people_served').html(chef_data.people_served);
		$('#p_food_cost').html(chef_data.food_cost);
		$('#p_rating_count').html(chef_data.rating_count);
		
		
		obRat = ratingCal( jsonData[i].rating_sum, jsonData[i].rating_count );
		$('#p_rating').prop('src', obRat['starImg'] );
		$('#rating_text').html( obRat['ratingTxt'] );
		
	}
	
	loadDishes(chef_id);
	
	$('#chef-foods').on('click', '.btnReserve',function(){
		//alert($(this).prop('data-dish'));
		var dish_id = $(this).prop('data-dish');
		var thisDish ;
		for (var i = 0; i < dishData.length; i++){
			if( dishData[i].id == dish_id ){
				thisDish = dishData[i];
				break;
			}
		}
		
		$('#dish_id').val( dish_id );
		$('#chef_id').val( thisDish.chef_id );
		$('#user_id').val( localStorage.getItem('userId') );
		$('#unit_price').val(thisDish.price);
		
		$('#modHeading').html( thisDish.dish_name );
		$('#modImg').prop('src', 'http://mobileapi.foodiesys.com/foodie-mssql/pics/'+thisDish.image2);
		$('#modPrice').html( 'Price : $'+thisDish.price+' &nbsp; Serving : '+thisDish.serving );
		
		obRat = ratingCal( thisDish.rating_sum, thisDish.rating_count );
		$('#modRatingImg').prop('src', obRat['starImg'] );
		$('#modRatingInfo').html(obRat['ratingTxt']+'&nbsp; '+thisDish.rating_count+' Reviews' );
		
		$('#popReserve').modal();
	});
	
	$('#btnOrder').on('click',function(){
		$('#frmReserve').submit();		
	});
	
	$('#frmReserve').validate({
		errorPlacement: function(error, element) {},
		submitHandler: function(form) {
			formData = $(form).serialize();
			$.ajax({
				type: "POST", dataType: 'json', url: "http://mobileapi.foodiesys.com/foodie-mssql/ajax.php?h=Reserve", data: formData,
				beforeSend: function() { waitingDialog.show('Loading', {dialogSize: 'sm', progressType: 'info'}); },
				complete: function() { waitingDialog.hide(); },
				error: function( jqXHR, textStatus, errorThrown ){ ajaxError( jqXHR ); },
				success: function(data) {
					if (data.Success == 'true') {
						$('#popReserve').modal('hide');
						BAlert.find('.modal-header h3').html('<i class="fa fa-check"></i> Success');
						BAlert.find('.modal-body').html('<p class="text-success">'+data.Msg+'</p>');
						BAlert.modal();
					} else { 
						BAlert.find('.modal-header h3').html('<i class="fa fa-exclamation-triangle"></i> Error');
						BAlert.find('.modal-body').html('<p class="text-danger">'+data.Msg+'</p>');
						BAlert.modal();
					}
					if (data.JS) { eval(data.JS); }
				}
			}); // ajax	
		
		}// submit handler
	});
	
});


function loadDishes(chef_id){
	formData = 'chef_id='+chef_id;
	console.log(formData);
	$.ajax({
		type: "POST", dataType: 'json', url: "http://mobileapi.foodiesys.com/foodie-mssql/ajax.php?h=getDishes", data: formData,
		beforeSend: function() { $('div.aLoading').show();  },
		complete: function() { $('div.aLoading').hide(); },
		error: function( jqXHR, textStatus, errorThrown ){ ajaxError( jqXHR ); },
		success: function(data) {
			if (data.Success == 'true') {
				if(data.Count > 0 ){
					dishData = data.Dishes;
					$DTemp = $('.food-listing');
					for (var i = 0; i < dishData.length; i++) {
						$copy = $DTemp.clone().removeClass('hidden');
						$copy.find('img.img-responsive').prop('src', 'http://mobileapi.foodiesys.com/foodie-mssql/pics/'+dishData[i].image1);
						$copy.find('a.dishTitle').html(dishData[i].dish_name);
						$copy.find('a.dishTitle').prop('rel', dishData[i].id );
						$copy.find('.btnReserve').prop('data-dish', dishData[i].id );
						$copy.find('p.dishInfo').html('Price : $'+dishData[i].price+' &nbsp; Serving : '+dishData[i].serving);
						
						obRat = ratingCal( dishData[i].rating_sum, dishData[i].rating_count );
						
						$copy.find('img.rating').prop('src', obRat['starImg']);
						$copy.find('.rating_info').html( obRat['ratingTxt']+' &nbsp; '+dishData[i].rating_count+' Reviews' );
						
						
						$copy.appendTo('#chef-foods');
					}
					//$DTemp.remove();
				}else{
					$('#chef-foods').html('<center>No Rocord Found!</center>');
				}
			}else { 
				BAlert.find('.modal-header h3').html('<i class="fa fa-exclamation-triangle"></i> Error');
				BAlert.find('.modal-body').html('<p class="text-danger">'+data.Msg+'</p>');
				BAlert.modal();
			}
			if (data.JS) { eval(data.JS); }
		}
	}); // ajax	
}

</script>

  </body>
</html>